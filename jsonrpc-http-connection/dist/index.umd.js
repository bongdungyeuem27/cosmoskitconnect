(function(E,g){typeof exports=="object"&&typeof module<"u"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(E=typeof globalThis<"u"?globalThis:E||self,g(E["@cosmoskitconnect/jsonrpc-http-connection"]={}))})(this,function(E){"use strict";var g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ye(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var j={exports:{}},O=typeof Reflect=="object"?Reflect:null,H=O&&typeof O.apply=="function"?O.apply:function(e,r,s){return Function.prototype.apply.call(e,r,s)},T;O&&typeof O.ownKeys=="function"?T=O.ownKeys:Object.getOwnPropertySymbols?T=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:T=function(e){return Object.getOwnPropertyNames(e)};function ve(t){console&&console.warn&&console.warn(t)}var F=Number.isNaN||function(e){return e!==e};function h(){h.init.call(this)}j.exports=h,j.exports.once=we,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var $=10;function P(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return $},set:function(t){if(typeof t!="number"||t<0||F(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");$=t}}),h.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||F(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function q(t){return t._maxListeners===void 0?h.defaultMaxListeners:t._maxListeners}h.prototype.getMaxListeners=function(){return q(this)},h.prototype.emit=function(e){for(var r=[],s=1;s<arguments.length;s++)r.push(arguments[s]);var o=e==="error",u=this._events;if(u!==void 0)o=o&&u.error===void 0;else if(!o)return!1;if(o){var a;if(r.length>0&&(a=r[0]),a instanceof Error)throw a;var l=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw l.context=a,l}var y=u[e];if(y===void 0)return!1;if(typeof y=="function")H(y,this,r);else for(var R=y.length,D=K(y,R),s=0;s<R;++s)H(D[s],this,r);return!0};function V(t,e,r,s){var o,u,a;if(P(r),u=t._events,u===void 0?(u=t._events=Object.create(null),t._eventsCount=0):(u.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),u=t._events),a=u[e]),a===void 0)a=u[e]=r,++t._eventsCount;else if(typeof a=="function"?a=u[e]=s?[r,a]:[a,r]:s?a.unshift(r):a.push(r),o=q(t),o>0&&a.length>o&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=a.length,ve(l)}return t}h.prototype.addListener=function(e,r){return V(this,e,r,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(e,r){return V(this,e,r,!0)};function be(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function k(t,e,r){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},o=be.bind(s);return o.listener=r,s.wrapFn=o,o}h.prototype.once=function(e,r){return P(r),this.on(e,k(this,e,r)),this},h.prototype.prependOnceListener=function(e,r){return P(r),this.prependListener(e,k(this,e,r)),this},h.prototype.removeListener=function(e,r){var s,o,u,a,l;if(P(r),o=this._events,o===void 0)return this;if(s=o[e],s===void 0)return this;if(s===r||s.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,s.listener||r));else if(typeof s!="function"){for(u=-1,a=s.length-1;a>=0;a--)if(s[a]===r||s[a].listener===r){l=s[a].listener,u=a;break}if(u<0)return this;u===0?s.shift():me(s,u),s.length===1&&(o[e]=s[0]),o.removeListener!==void 0&&this.emit("removeListener",e,l||r)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(e){var r,s,o;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var u=Object.keys(s),a;for(o=0;o<u.length;++o)a=u[o],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=s[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(o=r.length-1;o>=0;o--)this.removeListener(e,r[o]);return this};function z(t,e,r){var s=t._events;if(s===void 0)return[];var o=s[e];return o===void 0?[]:typeof o=="function"?r?[o.listener||o]:[o]:r?ge(o):K(o,o.length)}h.prototype.listeners=function(e){return z(this,e,!0)},h.prototype.rawListeners=function(e){return z(this,e,!1)},h.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):G.call(t,e)},h.prototype.listenerCount=G;function G(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}h.prototype.eventNames=function(){return this._eventsCount>0?T(this._events):[]};function K(t,e){for(var r=new Array(e),s=0;s<e;++s)r[s]=t[s];return r}function me(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function ge(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function we(t,e){return new Promise(function(r,s){function o(a){t.removeListener(e,u),s(a)}function u(){typeof t.removeListener=="function"&&t.removeListener("error",o),r([].slice.call(arguments))}J(t,e,u,{once:!0}),e!=="error"&&Ee(t,o,{once:!0})})}function Ee(t,e,r){typeof t.on=="function"&&J(t,"error",e,r)}function J(t,e,r,s){if(typeof t.on=="function")s.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function o(u){s.once&&t.removeEventListener(e,o),r(u)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var B={exports:{}};(function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof g<"u"&&g,s=function(){function u(){this.fetch=!1,this.DOMException=r.DOMException}return u.prototype=r,new u}();(function(u){(function(a){var l=typeof u<"u"&&u||typeof self<"u"&&self||typeof g<"u"&&g||{},y={searchParams:"URLSearchParams"in l,iterable:"Symbol"in l&&"iterator"in Symbol,blob:"FileReader"in l&&"Blob"in l&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in l,arrayBuffer:"ArrayBuffer"in l};function R(n){return n&&DataView.prototype.isPrototypeOf(n)}if(y.arrayBuffer)var D=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Ye=ArrayBuffer.isView||function(n){return n&&D.indexOf(Object.prototype.toString.call(n))>-1};function L(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(n)||n==="")throw new TypeError('Invalid character in header field name: "'+n+'"');return n.toLowerCase()}function M(n){return typeof n!="string"&&(n=String(n)),n}function U(n){var i={next:function(){var f=n.shift();return{done:f===void 0,value:f}}};return y.iterable&&(i[Symbol.iterator]=function(){return i}),i}function v(n){this.map={},n instanceof v?n.forEach(function(i,f){this.append(f,i)},this):Array.isArray(n)?n.forEach(function(i){if(i.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+i.length);this.append(i[0],i[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(i){this.append(i,n[i])},this)}v.prototype.append=function(n,i){n=L(n),i=M(i);var f=this.map[n];this.map[n]=f?f+", "+i:i},v.prototype.delete=function(n){delete this.map[L(n)]},v.prototype.get=function(n){return n=L(n),this.has(n)?this.map[n]:null},v.prototype.has=function(n){return this.map.hasOwnProperty(L(n))},v.prototype.set=function(n,i){this.map[L(n)]=M(i)},v.prototype.forEach=function(n,i){for(var f in this.map)this.map.hasOwnProperty(f)&&n.call(i,this.map[f],f,this)},v.prototype.keys=function(){var n=[];return this.forEach(function(i,f){n.push(f)}),U(n)},v.prototype.values=function(){var n=[];return this.forEach(function(i){n.push(i)}),U(n)},v.prototype.entries=function(){var n=[];return this.forEach(function(i,f){n.push([f,i])}),U(n)},y.iterable&&(v.prototype[Symbol.iterator]=v.prototype.entries);function N(n){if(!n._noBody){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}}function le(n){return new Promise(function(i,f){n.onload=function(){i(n.result)},n.onerror=function(){f(n.error)}})}function Ze(n){var i=new FileReader,f=le(i);return i.readAsArrayBuffer(n),f}function et(n){var i=new FileReader,f=le(i),d=/charset=([A-Za-z0-9_-]+)/.exec(n.type),p=d?d[1]:"utf-8";return i.readAsText(n,p),f}function tt(n){for(var i=new Uint8Array(n),f=new Array(i.length),d=0;d<i.length;d++)f[d]=String.fromCharCode(i[d]);return f.join("")}function he(n){if(n.slice)return n.slice(0);var i=new Uint8Array(n.byteLength);return i.set(new Uint8Array(n)),i.buffer}function de(){return this.bodyUsed=!1,this._initBody=function(n){this.bodyUsed=this.bodyUsed,this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:y.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:y.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:y.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():y.arrayBuffer&&y.blob&&R(n)?(this._bodyArrayBuffer=he(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):y.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||Ye(n))?this._bodyArrayBuffer=he(n):this._bodyText=n=Object.prototype.toString.call(n):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob&&(this.blob=function(){var n=N(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var n=N(this);return n||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(y.blob)return this.blob().then(Ze);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var n=N(this);if(n)return n;if(this._bodyBlob)return et(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(tt(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(it)}),this.json=function(){return this.text().then(JSON.parse)},this}var rt=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function nt(n){var i=n.toUpperCase();return rt.indexOf(i)>-1?i:n}function w(n,i){if(!(this instanceof w))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');i=i||{};var f=i.body;if(n instanceof w){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,i.headers||(this.headers=new v(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!f&&n._bodyInit!=null&&(f=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=i.credentials||this.credentials||"same-origin",(i.headers||!this.headers)&&(this.headers=new v(i.headers)),this.method=nt(i.method||this.method||"GET"),this.mode=i.mode||this.mode||null,this.signal=i.signal||this.signal||function(){if("AbortController"in l){var c=new AbortController;return c.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&f)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(f),(this.method==="GET"||this.method==="HEAD")&&(i.cache==="no-store"||i.cache==="no-cache")){var d=/([?&])_=[^&]*/;if(d.test(this.url))this.url=this.url.replace(d,"$1_="+new Date().getTime());else{var p=/\?/;this.url+=(p.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}w.prototype.clone=function(){return new w(this,{body:this._bodyInit})};function it(n){var i=new FormData;return n.trim().split("&").forEach(function(f){if(f){var d=f.split("="),p=d.shift().replace(/\+/g," "),c=d.join("=").replace(/\+/g," ");i.append(decodeURIComponent(p),decodeURIComponent(c))}}),i}function st(n){var i=new v,f=n.replace(/\r?\n[\t ]+/g," ");return f.split("\r").map(function(d){return d.indexOf(`
`)===0?d.substr(1,d.length):d}).forEach(function(d){var p=d.split(":"),c=p.shift().trim();if(c){var x=p.join(":").trim();try{i.append(c,x)}catch(I){console.warn("Response "+I.message)}}}),i}de.call(w.prototype);function m(n,i){if(!(this instanceof m))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(i||(i={}),this.type="default",this.status=i.status===void 0?200:i.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=i.statusText===void 0?"":""+i.statusText,this.headers=new v(i.headers),this.url=i.url||"",this._initBody(n)}de.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new v(this.headers),url:this.url})},m.error=function(){var n=new m(null,{status:200,statusText:""});return n.ok=!1,n.status=0,n.type="error",n};var ot=[301,302,303,307,308];m.redirect=function(n,i){if(ot.indexOf(i)===-1)throw new RangeError("Invalid status code");return new m(null,{status:i,headers:{location:n}})},a.DOMException=l.DOMException;try{new a.DOMException}catch{a.DOMException=function(i,f){this.message=i,this.name=f;var d=Error(i);this.stack=d.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function S(n,i){return new Promise(function(f,d){var p=new w(n,i);if(p.signal&&p.signal.aborted)return d(new a.DOMException("Aborted","AbortError"));var c=new XMLHttpRequest;function x(){c.abort()}c.onload=function(){var b={statusText:c.statusText,headers:st(c.getAllResponseHeaders()||"")};p.url.indexOf("file://")===0&&(c.status<200||c.status>599)?b.status=200:b.status=c.status,b.url="responseURL"in c?c.responseURL:b.headers.get("X-Request-URL");var _="response"in c?c.response:c.responseText;setTimeout(function(){f(new m(_,b))},0)},c.onerror=function(){setTimeout(function(){d(new TypeError("Network request failed"))},0)},c.ontimeout=function(){setTimeout(function(){d(new TypeError("Network request timed out"))},0)},c.onabort=function(){setTimeout(function(){d(new a.DOMException("Aborted","AbortError"))},0)};function I(b){try{return b===""&&l.location.href?l.location.href:b}catch{return b}}if(c.open(p.method,I(p.url),!0),p.credentials==="include"?c.withCredentials=!0:p.credentials==="omit"&&(c.withCredentials=!1),"responseType"in c&&(y.blob?c.responseType="blob":y.arrayBuffer&&(c.responseType="arraybuffer")),i&&typeof i.headers=="object"&&!(i.headers instanceof v||l.Headers&&i.headers instanceof l.Headers)){var pe=[];Object.getOwnPropertyNames(i.headers).forEach(function(b){pe.push(L(b)),c.setRequestHeader(b,M(i.headers[b]))}),p.headers.forEach(function(b,_){pe.indexOf(_)===-1&&c.setRequestHeader(_,b)})}else p.headers.forEach(function(b,_){c.setRequestHeader(_,b)});p.signal&&(p.signal.addEventListener("abort",x),c.onreadystatechange=function(){c.readyState===4&&p.signal.removeEventListener("abort",x)}),c.send(typeof p._bodyInit>"u"?null:p._bodyInit)})}return S.polyfill=!0,l.fetch||(l.fetch=S,l.Headers=v,l.Request=w,l.Response=m),a.Headers=v,a.Request=w,a.Response=m,a.fetch=S,Object.defineProperty(a,"__esModule",{value:!0}),a})({})})(s),s.fetch.ponyfill=!0,delete s.fetch.polyfill;var o=r.fetch?r:s;e=o.fetch,e.default=o.fetch,e.fetch=o.fetch,e.Headers=o.Headers,e.Request=o.Request,e.Response=o.Response,t.exports=e})(B,B.exports);var W=ye(B.exports);const _e=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Oe=t=>{const e=new RegExp('(?<!")(?<=:)\\b(\\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))(?=[,\\}\\]]|$)',"g"),r=t.replace(e,s=>`"${s}n"`);return JSON.parse(r,(s,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function Le(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Oe(t)}catch(e){return console.error("safeJsonParse error:",e),t}}function X(t){return typeof t=="string"?t:_e(t)||""}const Ae="PARSE_ERROR",Te="INVALID_REQUEST",Pe="METHOD_NOT_FOUND",Re="INVALID_PARAMS",Q="INTERNAL_ERROR",C="SERVER_ERROR",xe=[-32700,-32600,-32601,-32602,-32603],A={[Ae]:{code:-32700,message:"Parse error"},[Te]:{code:-32600,message:"Invalid Request"},[Pe]:{code:-32601,message:"Method not found"},[Re]:{code:-32602,message:"Invalid params"},[Q]:{code:-32603,message:"Internal error"},[C]:{code:-32e3,message:"Server error"}},Y=C;function je(t){return xe.includes(t)}function Z(t){return Object.keys(A).includes(t)?A[t]:A[Y]}function Be(t){return Object.values(A).find(e=>e.code===t)||A[Y]}function Ce(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var De=Object.defineProperty,Me=Object.defineProperties,Ue=Object.getOwnPropertyDescriptors,ee=Object.getOwnPropertySymbols,Ne=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable,te=(t,e,r)=>e in t?De(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ie=(t,e)=>{for(var r in e||(e={}))Ne.call(e,r)&&te(t,r,e[r]);if(ee)for(var r of ee(e))Se.call(e,r)&&te(t,r,e[r]);return t},He=(t,e)=>Me(t,Ue(e));class re{constructor(e){this.i=1;const r=e===8?new Uint8Array(1):e===16?new Uint16Array(1):new Uint32Array(1);this.initialValue=crypto.getRandomValues(r)[0]}getNextValue(){return this.initialValue+this.i++}}new re(8),new re(16);function Fe(t,e,r){return{id:t,jsonrpc:"2.0",error:$e(e,r)}}function $e(t,e){return typeof t>"u"?Z(Q):(typeof t=="string"&&(t=He(Ie({},Z(C)),{message:t})),typeof e<"u"&&(t.data=e),je(t.code)&&(t=Be(t.code)),t)}const qe="^https?:";function Ve(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function ke(t,e){const r=Ve(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function ne(t){return ke(t,qe)}var ze=Object.defineProperty,Ge=Object.defineProperties,Ke=Object.getOwnPropertyDescriptors,ie=Object.getOwnPropertySymbols,Je=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable,se=(t,e,r)=>e in t?ze(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oe=(t,e)=>{for(var r in e||(e={}))Je.call(e,r)&&se(t,r,e[r]);if(ie)for(var r of ie(e))We.call(e,r)&&se(t,r,e[r]);return t},ae=(t,e)=>Ge(t,Ke(e));const Xe={Accept:"application/json","Content-Type":"application/json"},Qe="POST",fe={headers:Xe,method:Qe},ue=10;class ce{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new j.exports.EventEmitter,this.isAvailable=!1,this.registering=!1,!ne(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=X(e),s=await(await W(this.url,ae(oe({},fe),{body:r}))).json();this.onPayload({data:s})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!ne(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,o)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),o(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));s()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=X({id:1,jsonrpc:"2.0",method:"test",params:[]});await W(e,ae(oe({},fe),{body:r}))}this.onOpen()}catch(r){const s=this.parseError(r);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Le(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const s=this.parseError(r),o=s.message||s.toString(),u=Fe(e,o);this.events.emit("payload",u)}parseError(e,r=this.url){return Ce(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>ue&&this.events.setMaxListeners(ue)}}E.HttpConnection=ce,E.default=ce,Object.defineProperty(E,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
