"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var L=require("@noble/ed25519"),W=require("bs58");function F(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function V(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}}),r.default=e,Object.freeze(r)}var w=V(L),M=F(W);function Y(e,r){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<e.length;s++){var b=e.charAt(s),I=b.charCodeAt(0);if(t[I]!==255)throw new TypeError(b+" is ambiguous");t[I]=s}var g=e.length,m=e.charAt(0),N=Math.log(g)/Math.log(256),z=Math.log(256)/Math.log(g);function H(o){if(o instanceof Uint8Array||(ArrayBuffer.isView(o)?o=new Uint8Array(o.buffer,o.byteOffset,o.byteLength):Array.isArray(o)&&(o=Uint8Array.from(o))),!(o instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(o.length===0)return"";for(var i=0,E=0,c=0,f=o.length;c!==f&&o[c]===0;)c++,i++;for(var h=(f-c)*z+1>>>0,a=new Uint8Array(h);c!==f;){for(var l=o[c],y=0,d=h-1;(l!==0||y<E)&&d!==-1;d--,y++)l+=256*a[d]>>>0,a[d]=l%g>>>0,l=l/g>>>0;if(l!==0)throw new Error("Non-zero carry");E=y,c++}for(var u=h-E;u!==h&&a[u]===0;)u++;for(var D=m.repeat(i);u<h;++u)D+=e.charAt(a[u]);return D}function x(o){if(typeof o!="string")throw new TypeError("Expected String");if(o.length===0)return new Uint8Array;var i=0;if(o[i]!==" "){for(var E=0,c=0;o[i]===m;)E++,i++;for(var f=(o.length-i)*N+1>>>0,h=new Uint8Array(f);o[i];){var a=t[o.charCodeAt(i)];if(a===255)return;for(var l=0,y=f-1;(a!==0||l<c)&&y!==-1;y--,l++)a+=g*h[y]>>>0,h[y]=a%256>>>0,a=a/256>>>0;if(a!==0)throw new Error("Non-zero carry");c=l,i++}if(o[i]!==" "){for(var d=f-c;d!==f&&h[d]===0;)d++;for(var u=new Uint8Array(E+(f-d)),D=E;d!==f;)u[D++]=h[d++];return u}}}function B(o){var i=x(o);if(i)return i;throw new Error(`Non-${r} character`)}return{encode:H,decodeUnsafe:x,decode:B}}var q=Y,Z=q;const G=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class Q{constructor(r,t,n){this.name=r,this.prefix=t,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class ee{constructor(r,t,n){if(this.name=r,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return j(this,r)}}class re{constructor(r){this.decoders=r}or(r){return j(this,r)}decode(r){const t=r[0],n=this.decoders[t];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const j=(e,r)=>new re({...e.decoders||{[e.prefix]:e},...r.decoders||{[r.prefix]:r}});class te{constructor(r,t,n,s){this.name=r,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new Q(r,t,n),this.decoder=new ee(r,t,s)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const ne=({name:e,prefix:r,encode:t,decode:n})=>new te(e,r,t,n),C=({prefix:e,name:r,alphabet:t})=>{const{encode:n,decode:s}=Z(t,r);return ne({prefix:e,name:r,encode:n,decode:b=>G(s(b))})},_=C({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});C({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const S=864e5,$="key",p=":",A="did",R="pkh",U=".",K="K36",J="Jxg",O=e=>e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),T=(e,r)=>{const t=new Uint8Array(e.length+r.length);return t.set(e),t.set(r,e.length),t},k=e=>Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length,v=e=>{if(!k(e))throw new Error(`Supplied object is not valid ${JSON.stringify(e)}`);return O(Buffer.from(new TextEncoder().encode(JSON.stringify(e))).toString("base64"))},oe=e=>`${A}${p}${R}${p}${e}`,ie=e=>e+S,P=(e,r,t)=>{const n=O(Buffer.from(t).toString("base64"));return`${v(e)}${U}${v(r)}${U}${n}`},X=(e,r)=>{const t=v(e),n=v(r);return`${t}${U}${n}`},ae=e=>{const r=M.default.decode(K),t=w.utils.hexToBytes(e),n=_.encode(T(r,t));return`${A}${p}${$}${p}${n}`},se=e=>{var r;const t=(r=e.split(p).pop())!=null?r:"",n=w.utils.bytesToHex(_.decode(t));if(!n.startsWith("ed01"))throw Error("Invalid Ed25519 key");return w.utils.hexToBytes(n.substring(4))},ce=e=>{const r=M.default.decode(J),t=w.utils.hexToBytes(e),n=_.encode(T(r,t));return`${A}${p}${$}${p}${n}`},de=e=>{var r;const t=(r=e.split(p).pop())!=null?r:"",n=w.utils.bytesToHex(_.decode(t));if(!n.startsWith("ec01"))throw Error("Invalid X25519 key");return w.utils.hexToBytes(n.substring(4))},fe=async(e,r)=>{const[,t]=e,n={alg:"EdDSA",typ:"JWT"},s=new TextEncoder().encode(X(n,r)),b=await w.sign(s,t);return P(n,r,b)};exports.DAY_IN_MS=S,exports.DID_DELIMITER=p,exports.DID_METHOD_KEY=$,exports.DID_METHOD_PKH=R,exports.DID_PREFIX=A,exports.JWT_DELIMITER=U,exports.MULTICODEC_ED25519_HEADER=K,exports.MULTICODEC_X25519_HEADER=J,exports.composeDidPkh=oe,exports.concatUInt8Arrays=T,exports.decodeEd25519Key=se,exports.decodeX25519Key=de,exports.encodeData=X,exports.encodeEd25519Key=ae,exports.encodeJwt=P,exports.encodeX25519Key=ce,exports.generateJWT=fe,exports.isValidObject=k,exports.jwtExp=ie,exports.makeBase64UrlSafe=O,exports.objectToHex=v;
//# sourceMappingURL=index.cjs.js.map
