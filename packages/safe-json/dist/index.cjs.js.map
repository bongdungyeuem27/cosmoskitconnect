{"version":3,"file":"index.cjs.js","sources":["../src/index.ts"],"sourcesContent":["/**\n * JSONStringify & JSONParse inspired by json-with-bigint\n * source: https://github.com/Ivan-Korolenko/json-with-bigint\n */\n/* \n  Function to serialize data to JSON string.\n  Converts all BigInt values to strings with \"n\" character at the end.\n*/\nconst JSONStringify = (data: any) =>\n  JSON.stringify(data, (_, value) => (typeof value === \"bigint\" ? value.toString() + \"n\" : value));\n\n/* \n  Function to parse JSON.\n  If JSON has values in our custom format BigInt (strings with \"n\" character at the end), we just parse them to BigInt values.\n  If JSON has big number values, but not in our custom format, we copy it, and in a copy we convert those values to our custom format, \n  then parse them to BigInt values.\n  Other values (not big numbers and not our custom format BigInt values) are not affected and parsed as native JSON.parse() would parse them.\n*/\nconst JSONParse = (json: string) => {\n  /*\n    Big numbers are found and marked using Regex with this condition:\n    Number's length is bigger than 16 || Number's length is 16 and any numerical digit of the number is greater than that of the Number.MAX_SAFE_INTEGER\n    Additionally, it skips values that are strings (between double quotes).\n    */\n  // prettier-ignore\n  // eslint-disable-next-line no-useless-escape\n  const numbersBiggerThanMaxInt = /(?<!\")(?<=:)\\b(\\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))(?=[,\\}\\]]|$)/g;\n  const serializedData = json.replace(numbersBiggerThanMaxInt, (match) => `\"${match}n\"`);\n  return JSON.parse(serializedData, (_, value) => {\n    const isCustomFormatBigInt = typeof value === \"string\" && value.match(/^\\d+n$/);\n\n    if (isCustomFormatBigInt) return BigInt(value.substring(0, value.length - 1));\n\n    return value;\n  });\n};\n\nexport function safeJsonParse<T = any>(value: string): T | string {\n  if (typeof value !== \"string\") {\n    throw new Error(`Cannot safe json parse value of type ${typeof value}`);\n  }\n  try {\n    return JSONParse(value);\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error(\"safeJsonParse error:\", e);\n    return value;\n  }\n}\n\nexport function safeJsonStringify(value: any): string {\n  return typeof value === \"string\" ? value : JSONStringify(value) || \"\";\n}\n"],"names":["JSONStringify","data","_","value","JSONParse","json","numbersBiggerThanMaxInt","serializedData","match","e"],"mappings":";;;;AAQA,MAAMA,CAAAA,CAAiBC,GACrB,IAAK,CAAA,SAAA,CAAUA,EAAM,CAACC,CAAAA,CAAGC,CAAW,GAAA,OAAOA,CAAU,EAAA,QAAA,CAAWA,EAAM,QAAS,EAAA,CAAI,GAAMA,CAAAA,CAAM,CAS3FC,CAAAA,CAAAA,CAAaC,GAAiB,CAQlC,MAAMC,CAA0B,CAAA,IAAA,MAAA,CAAC,iRAA4Q,CAAA,GAAC,EACxSC,CAAiBF,CAAAA,CAAAA,CAAK,QAAQC,CAA0BE,CAAAA,CAAAA,EAAU,IAAIA,CAAS,CAAA,EAAA,CAAA,CAAA,CACrF,OAAO,IAAA,CAAK,KAAMD,CAAAA,CAAAA,CAAgB,CAACL,CAAGC,CAAAA,CAAAA,GACP,OAAOA,CAAAA,EAAU,QAAYA,EAAAA,CAAAA,CAAM,MAAM,QAAQ,CAAA,CAE7C,MAAOA,CAAAA,CAAAA,CAAM,SAAU,CAAA,CAAA,CAAGA,EAAM,MAAS,CAAA,CAAC,CAAC,CAErEA,CAAAA,CACR,CACH,CAEO,CAAA,SAAS,aAAuBA,CAAAA,CAAAA,CAA2B,CAChE,GAAI,OAAOA,CAAU,EAAA,QAAA,CACnB,MAAM,IAAI,KAAM,CAAA,CAAA,qCAAA,EAAwC,OAAOA,CAAO,CAAA,CAAA,CAAA,CAExE,GAAI,CACF,OAAOC,CAAAA,CAAUD,CAAK,CACxB,CAAA,MAASM,EAAP,CAEA,OAAA,OAAA,CAAQ,MAAM,sBAAwBA,CAAAA,CAAC,CAChCN,CAAAA,CACT,CACF,UAEgB,iBAAkBA,CAAAA,CAAAA,CAAoB,CACpD,OAAO,OAAOA,CAAAA,EAAU,SAAWA,CAAQH,CAAAA,CAAAA,CAAcG,CAAK,CAAA,EAAK,EACrE;;;;;"}