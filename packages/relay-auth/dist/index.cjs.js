"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ge=require("@stablelib/ed25519"),ve=require("@stablelib/random"),me=require("@cosmoskitconnect/time"),q=require("@cosmoskitconnect/safe-json");function Fe(e){if(e&&e.__esModule)return e;var D=Object.create(null);return e&&Object.keys(e).forEach(function(u){if(u!=="default"){var r=Object.getOwnPropertyDescriptor(e,u);Object.defineProperty(D,u,r.get?r:{enumerable:!0,get:function(){return e[u]}})}}),D.default=e,Object.freeze(D)}var S=Fe(ge);const J="EdDSA",j="JWT",g=".",F="base64url",z="utf8",N="utf8",P=":",L="did",$="key",T="base58btc",R="z",W="K36",V=32,X=32;function Y(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}function Te(e,D){D||(D=e.reduce((t,n)=>t+n.length,0));const u=Y(D);let r=0;for(const t of e)u.set(t,r),r+=t.length;return u}function Ie(e,D){if(e.length>=255)throw new TypeError("Alphabet too long");for(var u=new Uint8Array(256),r=0;r<u.length;r++)u[r]=255;for(var t=0;t<e.length;t++){var n=e.charAt(t),s=n.charCodeAt(0);if(u[s]!==255)throw new TypeError(n+" is ambiguous");u[s]=t}var o=e.length,c=e.charAt(0),m=Math.log(o)/Math.log(256),f=Math.log(256)/Math.log(o);function B(a){if(a instanceof Uint8Array||(ArrayBuffer.isView(a)?a=new Uint8Array(a.buffer,a.byteOffset,a.byteLength):Array.isArray(a)&&(a=Uint8Array.from(a))),!(a instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(a.length===0)return"";for(var d=0,y=0,h=0,l=a.length;h!==l&&a[h]===0;)h++,d++;for(var p=(l-h)*f+1>>>0,E=new Uint8Array(p);h!==l;){for(var C=a[h],_=0,b=p-1;(C!==0||_<y)&&b!==-1;b--,_++)C+=256*E[b]>>>0,E[b]=C%o>>>0,C=C/o>>>0;if(C!==0)throw new Error("Non-zero carry");y=_,h++}for(var w=p-y;w!==p&&E[w]===0;)w++;for(var U=c.repeat(d);w<p;++w)U+=e.charAt(E[w]);return U}function H(a){if(typeof a!="string")throw new TypeError("Expected String");if(a.length===0)return new Uint8Array;var d=0;if(a[d]!==" "){for(var y=0,h=0;a[d]===c;)y++,d++;for(var l=(a.length-d)*m+1>>>0,p=new Uint8Array(l);a[d];){var E=u[a.charCodeAt(d)];if(E===255)return;for(var C=0,_=l-1;(E!==0||C<h)&&_!==-1;_--,C++)E+=o*p[_]>>>0,p[_]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");h=C,d++}if(a[d]!==" "){for(var b=l-h;b!==l&&p[b]===0;)b++;for(var w=new Uint8Array(y+(l-b)),U=y;b!==l;)w[U++]=p[b++];return w}}}function Ae(a){var d=H(a);if(d)return d;throw new Error(`Non-${D} character`)}return{encode:B,decodeUnsafe:H,decode:Ae}}var xe=Ie,Oe=xe;const Q=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},Be=e=>new TextEncoder().encode(e),Ue=e=>new TextDecoder().decode(e);class Ne{constructor(D,u,r){this.name=D,this.prefix=u,this.baseEncode=r}encode(D){if(D instanceof Uint8Array)return`${this.prefix}${this.baseEncode(D)}`;throw Error("Unknown type, must be binary type")}}class Me{constructor(D,u,r){if(this.name=D,this.prefix=u,u.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=u.codePointAt(0),this.baseDecode=r}decode(D){if(typeof D=="string"){if(D.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(D)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(D.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(D){return Z(this,D)}}class Se{constructor(D){this.decoders=D}or(D){return Z(this,D)}decode(D){const u=D[0],r=this.decoders[u];if(r)return r.decode(D);throw RangeError(`Unable to decode multibase string ${JSON.stringify(D)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Z=(e,D)=>new Se({...e.decoders||{[e.prefix]:e},...D.decoders||{[D.prefix]:D}});class Je{constructor(D,u,r,t){this.name=D,this.prefix=u,this.baseEncode=r,this.baseDecode=t,this.encoder=new Ne(D,u,r),this.decoder=new Me(D,u,t)}encode(D){return this.encoder.encode(D)}decode(D){return this.decoder.decode(D)}}const M=({name:e,prefix:D,encode:u,decode:r})=>new Je(e,D,u,r),I=({prefix:e,name:D,alphabet:u})=>{const{encode:r,decode:t}=Oe(u,D);return M({prefix:e,name:D,encode:r,decode:n=>Q(t(n))})},je=(e,D,u,r)=>{const t={};for(let f=0;f<D.length;++f)t[D[f]]=f;let n=e.length;for(;e[n-1]==="=";)--n;const s=new Uint8Array(n*u/8|0);let o=0,c=0,m=0;for(let f=0;f<n;++f){const B=t[e[f]];if(B===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<u|B,o+=u,o>=8&&(o-=8,s[m++]=255&c>>o)}if(o>=u||255&c<<8-o)throw new SyntaxError("Unexpected end of data");return s},ze=(e,D,u)=>{const r=D[D.length-1]==="=",t=(1<<u)-1;let n="",s=0,o=0;for(let c=0;c<e.length;++c)for(o=o<<8|e[c],s+=8;s>u;)s-=u,n+=D[t&o>>s];if(s&&(n+=D[t&o<<u-s]),r)for(;n.length*u&7;)n+="=";return n},i=({name:e,prefix:D,bitsPerChar:u,alphabet:r})=>M({prefix:D,name:e,encode(t){return ze(t,r,u)},decode(t){return je(t,r,u,e)}}),Pe=M({prefix:"\0",name:"identity",encode:e=>Ue(e),decode:e=>Be(e)});var Le=Object.freeze({__proto__:null,identity:Pe});const $e=i({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Re=Object.freeze({__proto__:null,base2:$e});const We=i({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Ge=Object.freeze({__proto__:null,base8:We});const ke=I({prefix:"9",name:"base10",alphabet:"0123456789"});var Ke=Object.freeze({__proto__:null,base10:ke});const He=i({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),qe=i({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Ve=Object.freeze({__proto__:null,base16:He,base16upper:qe});const Xe=i({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ye=i({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Qe=i({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ze=i({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),eD=i({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),DD=i({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),uD=i({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),rD=i({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),tD=i({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var nD=Object.freeze({__proto__:null,base32:Xe,base32upper:Ye,base32pad:Qe,base32padupper:Ze,base32hex:eD,base32hexupper:DD,base32hexpad:uD,base32hexpadupper:rD,base32z:tD});const aD=I({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),oD=I({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var sD=Object.freeze({__proto__:null,base36:aD,base36upper:oD});const iD=I({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),cD=I({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var dD=Object.freeze({__proto__:null,base58btc:iD,base58flickr:cD});const fD=i({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ED=i({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),hD=i({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),bD=i({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var lD=Object.freeze({__proto__:null,base64:fD,base64pad:ED,base64url:hD,base64urlpad:bD});const ee=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),pD=ee.reduce((e,D,u)=>(e[u]=D,e),[]),CD=ee.reduce((e,D,u)=>(e[D.codePointAt(0)]=u,e),[]);function wD(e){return e.reduce((D,u)=>(D+=pD[u],D),"")}function _D(e){const D=[];for(const u of e){const r=CD[u.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${u}`);D.push(r)}return new Uint8Array(D)}const yD=M({prefix:"\u{1F680}",name:"base256emoji",encode:wD,decode:_D});var AD=Object.freeze({__proto__:null,base256emoji:yD}),gD=ue,De=128,vD=127,mD=~vD,FD=Math.pow(2,31);function ue(e,D,u){D=D||[],u=u||0;for(var r=u;e>=FD;)D[u++]=e&255|De,e/=128;for(;e&mD;)D[u++]=e&255|De,e>>>=7;return D[u]=e|0,ue.bytes=u-r+1,D}var TD=G,ID=128,re=127;function G(e,r){var u=0,r=r||0,t=0,n=r,s,o=e.length;do{if(n>=o)throw G.bytes=0,new RangeError("Could not decode varint");s=e[n++],u+=t<28?(s&re)<<t:(s&re)*Math.pow(2,t),t+=7}while(s>=ID);return G.bytes=n-r,u}var xD=Math.pow(2,7),OD=Math.pow(2,14),BD=Math.pow(2,21),UD=Math.pow(2,28),ND=Math.pow(2,35),MD=Math.pow(2,42),SD=Math.pow(2,49),JD=Math.pow(2,56),jD=Math.pow(2,63),zD=function(e){return e<xD?1:e<OD?2:e<BD?3:e<UD?4:e<ND?5:e<MD?6:e<SD?7:e<JD?8:e<jD?9:10},PD={encode:gD,decode:TD,encodingLength:zD},te=PD;const ne=(e,D,u=0)=>(te.encode(e,D,u),D),ae=e=>te.encodingLength(e),k=(e,D)=>{const u=D.byteLength,r=ae(e),t=r+ae(u),n=new Uint8Array(t+u);return ne(e,n,0),ne(u,n,r),n.set(D,t),new LD(e,u,D,n)};class LD{constructor(D,u,r,t){this.code=D,this.size=u,this.digest=r,this.bytes=t}}const oe=({name:e,code:D,encode:u})=>new $D(e,D,u);class $D{constructor(D,u,r){this.name=D,this.code=u,this.encode=r}digest(D){if(D instanceof Uint8Array){const u=this.encode(D);return u instanceof Uint8Array?k(this.code,u):u.then(r=>k(this.code,r))}else throw Error("Unknown type, must be binary type")}}const se=e=>async D=>new Uint8Array(await crypto.subtle.digest(e,D)),RD=oe({name:"sha2-256",code:18,encode:se("SHA-256")}),WD=oe({name:"sha2-512",code:19,encode:se("SHA-512")});var GD=Object.freeze({__proto__:null,sha256:RD,sha512:WD});const ie=0,kD="identity",ce=Q,KD=e=>k(ie,ce(e)),HD={code:ie,name:kD,encode:ce,digest:KD};var qD=Object.freeze({__proto__:null,identity:HD});new TextEncoder,new TextDecoder;const de={...Le,...Re,...Ge,...Ke,...Ve,...nD,...sD,...dD,...lD,...AD};({...GD,...qD});function fe(e,D,u,r){return{name:e,prefix:D,encoder:{name:e,prefix:D,encode:u},decoder:{decode:r}}}const Ee=fe("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),K=fe("ascii","a",e=>{let D="a";for(let u=0;u<e.length;u++)D+=String.fromCharCode(e[u]);return D},e=>{e=e.substring(1);const D=Y(e.length);for(let u=0;u<e.length;u++)D[u]=e.charCodeAt(u);return D}),he={utf8:Ee,"utf-8":Ee,hex:de.base16,latin1:K,ascii:K,binary:K,...de};function v(e,D="utf8"){const u=he[D];if(!u)throw new Error(`Unsupported encoding "${D}"`);return(D==="utf8"||D==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):u.encoder.encode(e).substring(1)}function A(e,D="utf8"){const u=he[D];if(!u)throw new Error(`Unsupported encoding "${D}"`);return(D==="utf8"||D==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e,"utf8"):u.decoder.decode(`${u.prefix}${e}`)}function x(e){return q.safeJsonParse(v(A(e,F),z))}function O(e){return v(A(q.safeJsonStringify(e),z),F)}function be(e){const D=A(W,T),u=R+v(Te([D,e]),T);return[L,$,u].join(P)}function le(e){const[D,u,r]=e.split(P);if(D!==L||u!==$)throw new Error('Issuer must be a DID with method "key"');if(r.slice(0,1)!==R)throw new Error("Issuer must be a key in mulicodec format");const t=A(r.slice(1),T);if(v(t.slice(0,2),T)!==W)throw new Error('Issuer must be a public key with type "Ed25519"');const n=t.slice(2);if(n.length!==V)throw new Error("Issuer must be a public key with length 32 bytes");return n}function pe(e){return v(e,F)}function Ce(e){return A(e,F)}function we(e){return A([O(e.header),O(e.payload)].join(g),N)}function VD(e){const D=v(e,N).split(g),u=x(D[0]),r=x(D[1]);return{header:u,payload:r}}function _e(e){return[O(e.header),O(e.payload),pe(e.signature)].join(g)}function ye(e){const D=e.split(g),u=x(D[0]),r=x(D[1]),t=Ce(D[2]),n=A(D.slice(0,2).join(g),N);return{header:u,payload:r,signature:t,data:n}}function XD(e=ve.randomBytes(X)){return S.generateKeyPairFromSeed(e)}async function YD(e,D,u,r,t=me.fromMiliseconds(Date.now())){const n={alg:J,typ:j},s=be(r.publicKey),o=t+u,c={iss:s,sub:e,aud:D,iat:t,exp:o},m=we({header:n,payload:c}),f=S.sign(r.secretKey,m);return _e({header:n,payload:c,signature:f})}async function QD(e){const{header:D,payload:u,data:r,signature:t}=ye(e);if(D.alg!==J||D.typ!==j)throw new Error("JWT must use EdDSA algorithm");const n=le(u.iss);return S.verify(n,r,t)}exports.DATA_ENCODING=N,exports.DID_DELIMITER=P,exports.DID_METHOD=$,exports.DID_PREFIX=L,exports.JSON_ENCODING=z,exports.JWT_DELIMITER=g,exports.JWT_ENCODING=F,exports.JWT_IRIDIUM_ALG=J,exports.JWT_IRIDIUM_TYP=j,exports.KEY_PAIR_SEED_LENGTH=X,exports.MULTICODEC_ED25519_BASE=R,exports.MULTICODEC_ED25519_ENCODING=T,exports.MULTICODEC_ED25519_HEADER=W,exports.MULTICODEC_ED25519_LENGTH=V,exports.decodeData=VD,exports.decodeIss=le,exports.decodeJSON=x,exports.decodeJWT=ye,exports.decodeSig=Ce,exports.encodeData=we,exports.encodeIss=be,exports.encodeJSON=O,exports.encodeJWT=_e,exports.encodeSig=pe,exports.generateKeyPair=XD,exports.signJWT=YD,exports.verifyJWT=QD;
//# sourceMappingURL=index.cjs.js.map
