import*as N from"@stablelib/ed25519";import{randomBytes as ge}from"@stablelib/random";import{fromMiliseconds as me}from"@cosmoskitconnect/time";import{safeJsonParse as _e,safeJsonStringify as Fe}from"@cosmoskitconnect/safe-json";const z="EdDSA",$="JWT",m=".",v="base64url",j="utf8",I="utf8",P=":",J="did",k="key",x="base58btc",L="z",R="K36",H=32,q=32;function X(e=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}function ve(e,D){D||(D=e.reduce((t,n)=>t+n.length,0));const u=X(D);let r=0;for(const t of e)u.set(t,r),r+=t.length;return u}function xe(e,D){if(e.length>=255)throw new TypeError("Alphabet too long");for(var u=new Uint8Array(256),r=0;r<u.length;r++)u[r]=255;for(var t=0;t<e.length;t++){var n=e.charAt(t),s=n.charCodeAt(0);if(u[s]!==255)throw new TypeError(n+" is ambiguous");u[s]=t}var a=e.length,c=e.charAt(0),F=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function O(o){if(o instanceof Uint8Array||(ArrayBuffer.isView(o)?o=new Uint8Array(o.buffer,o.byteOffset,o.byteLength):Array.isArray(o)&&(o=Uint8Array.from(o))),!(o instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(o.length===0)return"";for(var d=0,A=0,b=0,l=o.length;b!==l&&o[b]===0;)b++,d++;for(var p=(l-b)*f+1>>>0,h=new Uint8Array(p);b!==l;){for(var C=o[b],y=0,E=p-1;(C!==0||y<A)&&E!==-1;E--,y++)C+=256*h[E]>>>0,h[E]=C%a>>>0,C=C/a>>>0;if(C!==0)throw new Error("Non-zero carry");A=y,b++}for(var w=p-A;w!==p&&h[w]===0;)w++;for(var S=c.repeat(d);w<p;++w)S+=e.charAt(h[w]);return S}function V(o){if(typeof o!="string")throw new TypeError("Expected String");if(o.length===0)return new Uint8Array;var d=0;if(o[d]!==" "){for(var A=0,b=0;o[d]===c;)A++,d++;for(var l=(o.length-d)*F+1>>>0,p=new Uint8Array(l);o[d];){var h=u[o.charCodeAt(d)];if(h===255)return;for(var C=0,y=l-1;(h!==0||C<b)&&y!==-1;y--,C++)h+=a*p[y]>>>0,p[y]=h%256>>>0,h=h/256>>>0;if(h!==0)throw new Error("Non-zero carry");b=C,d++}if(o[d]!==" "){for(var E=l-b;E!==l&&p[E]===0;)E++;for(var w=new Uint8Array(A+(l-E)),S=A;E!==l;)w[S++]=p[E++];return w}}}function Ae(o){var d=V(o);if(d)return d;throw new Error(`Non-${D} character`)}return{encode:O,decodeUnsafe:V,decode:Ae}}var Be=xe,Te=Be;const Q=e=>{if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},Ue=e=>new TextEncoder().encode(e),Oe=e=>new TextDecoder().decode(e);class Se{constructor(D,u,r){this.name=D,this.prefix=u,this.baseEncode=r}encode(D){if(D instanceof Uint8Array)return`${this.prefix}${this.baseEncode(D)}`;throw Error("Unknown type, must be binary type")}}class Ie{constructor(D,u,r){if(this.name=D,this.prefix=u,u.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=u.codePointAt(0),this.baseDecode=r}decode(D){if(typeof D=="string"){if(D.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(D)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(D.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(D){return Y(this,D)}}class Me{constructor(D){this.decoders=D}or(D){return Y(this,D)}decode(D){const u=D[0],r=this.decoders[u];if(r)return r.decode(D);throw RangeError(`Unable to decode multibase string ${JSON.stringify(D)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Y=(e,D)=>new Me({...e.decoders||{[e.prefix]:e},...D.decoders||{[D.prefix]:D}});class Ne{constructor(D,u,r,t){this.name=D,this.prefix=u,this.baseEncode=r,this.baseDecode=t,this.encoder=new Se(D,u,r),this.decoder=new Ie(D,u,t)}encode(D){return this.encoder.encode(D)}decode(D){return this.decoder.decode(D)}}const M=({name:e,prefix:D,encode:u,decode:r})=>new Ne(e,D,u,r),B=({prefix:e,name:D,alphabet:u})=>{const{encode:r,decode:t}=Te(u,D);return M({prefix:e,name:D,encode:r,decode:n=>Q(t(n))})},ze=(e,D,u,r)=>{const t={};for(let f=0;f<D.length;++f)t[D[f]]=f;let n=e.length;for(;e[n-1]==="=";)--n;const s=new Uint8Array(n*u/8|0);let a=0,c=0,F=0;for(let f=0;f<n;++f){const O=t[e[f]];if(O===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<u|O,a+=u,a>=8&&(a-=8,s[F++]=255&c>>a)}if(a>=u||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s},$e=(e,D,u)=>{const r=D[D.length-1]==="=",t=(1<<u)-1;let n="",s=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],s+=8;s>u;)s-=u,n+=D[t&a>>s];if(s&&(n+=D[t&a<<u-s]),r)for(;n.length*u&7;)n+="=";return n},i=({name:e,prefix:D,bitsPerChar:u,alphabet:r})=>M({prefix:D,name:e,encode(t){return $e(t,r,u)},decode(t){return ze(t,r,u,e)}}),je=M({prefix:"\0",name:"identity",encode:e=>Oe(e),decode:e=>Ue(e)});var Pe=Object.freeze({__proto__:null,identity:je});const Je=i({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ke=Object.freeze({__proto__:null,base2:Je});const Le=i({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Re=Object.freeze({__proto__:null,base8:Le});const We=B({prefix:"9",name:"base10",alphabet:"0123456789"});var Ge=Object.freeze({__proto__:null,base10:We});const Ke=i({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ve=i({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var He=Object.freeze({__proto__:null,base16:Ke,base16upper:Ve});const qe=i({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Xe=i({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Qe=i({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ye=i({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ze=i({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),eD=i({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),DD=i({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),uD=i({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),rD=i({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var tD=Object.freeze({__proto__:null,base32:qe,base32upper:Xe,base32pad:Qe,base32padupper:Ye,base32hex:Ze,base32hexupper:eD,base32hexpad:DD,base32hexpadupper:uD,base32z:rD});const nD=B({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),oD=B({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var aD=Object.freeze({__proto__:null,base36:nD,base36upper:oD});const sD=B({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),iD=B({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var cD=Object.freeze({__proto__:null,base58btc:sD,base58flickr:iD});const dD=i({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),fD=i({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),hD=i({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),bD=i({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ED=Object.freeze({__proto__:null,base64:dD,base64pad:fD,base64url:hD,base64urlpad:bD});const Z=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),lD=Z.reduce((e,D,u)=>(e[u]=D,e),[]),pD=Z.reduce((e,D,u)=>(e[D.codePointAt(0)]=u,e),[]);function CD(e){return e.reduce((D,u)=>(D+=lD[u],D),"")}function wD(e){const D=[];for(const u of e){const r=pD[u.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${u}`);D.push(r)}return new Uint8Array(D)}const yD=M({prefix:"\u{1F680}",name:"base256emoji",encode:CD,decode:wD});var AD=Object.freeze({__proto__:null,base256emoji:yD}),gD=De,ee=128,mD=127,_D=~mD,FD=Math.pow(2,31);function De(e,D,u){D=D||[],u=u||0;for(var r=u;e>=FD;)D[u++]=e&255|ee,e/=128;for(;e&_D;)D[u++]=e&255|ee,e>>>=7;return D[u]=e|0,De.bytes=u-r+1,D}var vD=W,xD=128,ue=127;function W(e,r){var u=0,r=r||0,t=0,n=r,s,a=e.length;do{if(n>=a)throw W.bytes=0,new RangeError("Could not decode varint");s=e[n++],u+=t<28?(s&ue)<<t:(s&ue)*Math.pow(2,t),t+=7}while(s>=xD);return W.bytes=n-r,u}var BD=Math.pow(2,7),TD=Math.pow(2,14),UD=Math.pow(2,21),OD=Math.pow(2,28),SD=Math.pow(2,35),ID=Math.pow(2,42),MD=Math.pow(2,49),ND=Math.pow(2,56),zD=Math.pow(2,63),$D=function(e){return e<BD?1:e<TD?2:e<UD?3:e<OD?4:e<SD?5:e<ID?6:e<MD?7:e<ND?8:e<zD?9:10},jD={encode:gD,decode:vD,encodingLength:$D},re=jD;const te=(e,D,u=0)=>(re.encode(e,D,u),D),ne=e=>re.encodingLength(e),G=(e,D)=>{const u=D.byteLength,r=ne(e),t=r+ne(u),n=new Uint8Array(t+u);return te(e,n,0),te(u,n,r),n.set(D,t),new PD(e,u,D,n)};class PD{constructor(D,u,r,t){this.code=D,this.size=u,this.digest=r,this.bytes=t}}const oe=({name:e,code:D,encode:u})=>new JD(e,D,u);class JD{constructor(D,u,r){this.name=D,this.code=u,this.encode=r}digest(D){if(D instanceof Uint8Array){const u=this.encode(D);return u instanceof Uint8Array?G(this.code,u):u.then(r=>G(this.code,r))}else throw Error("Unknown type, must be binary type")}}const ae=e=>async D=>new Uint8Array(await crypto.subtle.digest(e,D)),kD=oe({name:"sha2-256",code:18,encode:ae("SHA-256")}),LD=oe({name:"sha2-512",code:19,encode:ae("SHA-512")});var RD=Object.freeze({__proto__:null,sha256:kD,sha512:LD});const se=0,WD="identity",ie=Q,GD=e=>G(se,ie(e)),KD={code:se,name:WD,encode:ie,digest:GD};var VD=Object.freeze({__proto__:null,identity:KD});new TextEncoder,new TextDecoder;const ce={...Pe,...ke,...Re,...Ge,...He,...tD,...aD,...cD,...ED,...AD};({...RD,...VD});function de(e,D,u,r){return{name:e,prefix:D,encoder:{name:e,prefix:D,encode:u},decoder:{decode:r}}}const fe=de("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),K=de("ascii","a",e=>{let D="a";for(let u=0;u<e.length;u++)D+=String.fromCharCode(e[u]);return D},e=>{e=e.substring(1);const D=X(e.length);for(let u=0;u<e.length;u++)D[u]=e.charCodeAt(u);return D}),he={utf8:fe,"utf-8":fe,hex:ce.base16,latin1:K,ascii:K,binary:K,...ce};function _(e,D="utf8"){const u=he[D];if(!u)throw new Error(`Unsupported encoding "${D}"`);return(D==="utf8"||D==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8"):u.encoder.encode(e).substring(1)}function g(e,D="utf8"){const u=he[D];if(!u)throw new Error(`Unsupported encoding "${D}"`);return(D==="utf8"||D==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(e,"utf8"):u.decoder.decode(`${u.prefix}${e}`)}function T(e){return _e(_(g(e,v),j))}function U(e){return _(g(Fe(e),j),v)}function be(e){const D=g(R,x),u=L+_(ve([D,e]),x);return[J,k,u].join(P)}function Ee(e){const[D,u,r]=e.split(P);if(D!==J||u!==k)throw new Error('Issuer must be a DID with method "key"');if(r.slice(0,1)!==L)throw new Error("Issuer must be a key in mulicodec format");const t=g(r.slice(1),x);if(_(t.slice(0,2),x)!==R)throw new Error('Issuer must be a public key with type "Ed25519"');const n=t.slice(2);if(n.length!==H)throw new Error("Issuer must be a public key with length 32 bytes");return n}function le(e){return _(e,v)}function pe(e){return g(e,v)}function Ce(e){return g([U(e.header),U(e.payload)].join(m),I)}function HD(e){const D=_(e,I).split(m),u=T(D[0]),r=T(D[1]);return{header:u,payload:r}}function we(e){return[U(e.header),U(e.payload),le(e.signature)].join(m)}function ye(e){const D=e.split(m),u=T(D[0]),r=T(D[1]),t=pe(D[2]),n=g(D.slice(0,2).join(m),I);return{header:u,payload:r,signature:t,data:n}}function qD(e=ge(q)){return N.generateKeyPairFromSeed(e)}async function XD(e,D,u,r,t=me(Date.now())){const n={alg:z,typ:$},s=be(r.publicKey),a=t+u,c={iss:s,sub:e,aud:D,iat:t,exp:a},F=Ce({header:n,payload:c}),f=N.sign(r.secretKey,F);return we({header:n,payload:c,signature:f})}async function QD(e){const{header:D,payload:u,data:r,signature:t}=ye(e);if(D.alg!==z||D.typ!==$)throw new Error("JWT must use EdDSA algorithm");const n=Ee(u.iss);return N.verify(n,r,t)}export{I as DATA_ENCODING,P as DID_DELIMITER,k as DID_METHOD,J as DID_PREFIX,j as JSON_ENCODING,m as JWT_DELIMITER,v as JWT_ENCODING,z as JWT_IRIDIUM_ALG,$ as JWT_IRIDIUM_TYP,q as KEY_PAIR_SEED_LENGTH,L as MULTICODEC_ED25519_BASE,x as MULTICODEC_ED25519_ENCODING,R as MULTICODEC_ED25519_HEADER,H as MULTICODEC_ED25519_LENGTH,HD as decodeData,Ee as decodeIss,T as decodeJSON,ye as decodeJWT,pe as decodeSig,Ce as encodeData,be as encodeIss,U as encodeJSON,we as encodeJWT,le as encodeSig,qD as generateKeyPair,XD as signJWT,QD as verifyJWT};
//# sourceMappingURL=index.es.js.map
